-- Universal Script Hub - Fixed Integration Version
-- This properly integrates with your lynkUI library

-- Load your UI library
local Lynk = loadstring(game:HttpGet("https://raw.githubusercontent.com/vvisuall/lynkUI/refs/heads/main/source"))()

-- Create window first
local Window = Lynk:CreateWindow({
    Name = "Universal Script Hub",
    Title = "LYNK | No.1 Scripthub", 
    Subtitle = "Find any script for any game | Made by @x_vvw on Discord",
    Accent = Color3.fromRGB(88, 101, 242),
    DefaultKeybind = Enum.KeyCode.Insert
})

Window:Show()

-- Load script database from GitHub with proper error handling
local function loadScriptDatabase()
    local success, result = pcall(function()
        return loadstring(game:HttpGet("https://raw.githubusercontent.com/vvisuall/lynkUI/refs/heads/main/scripts.lua"))()
    end)
    
    if success and result then
        print("‚úÖ Script database loaded successfully!")
        return result
    else
        print("‚ùå Failed to load script database:", result)
        -- Fallback database with correct property names
        return {
            ["Universal"] = {
                gameName = "Universal Scripts",
                scripts = {
                    {
                        Title = "Infinite Yield", 
                        Description = "Admin commands for any game", 
                        LoadString = 'loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))()', 
                        RequiresKey = false
                    },
                    {
                        Title = "Fly Script", 
                        Description = "Universal fly script", 
                        LoadString = 'print("Fly script would execute here")', 
                        RequiresKey = false
                    }
                }
            }
        }
    end
end

-- Load the database
local SCRIPT_DATABASE = loadScriptDatabase()

-- Override the SCRIPT_DATABASE in the UI library
-- This ensures the UI uses our loaded database
spawn(function()
    wait(0.5) -- Wait for UI to initialize
    
    -- Inject our database into the UI library's scope
    if Window and Window._scriptDatabase then
        Window._scriptDatabase = SCRIPT_DATABASE
    end
    
    -- Force populate the home tab with our scripts
    if Window.LoadScriptCards then
        Window:LoadScriptCards()
    end
end)

-- Create tabs using the UI library's built-in functions
local HomeTab = Window:CreateTab("Home", "rbxassetid://10734950309")
local UpdatesTab = Window:CreateTab("Updates", "rbxassetid://10734949856")
local CreditsTab = Window:CreateTab("Credits", "rbxassetid://10734949856") 
local SettingsTab = Window:CreateTab("Settings", "rbxassetid://10734950020")

-- Add content to Updates tab
UpdatesTab:CreateLabel("üöÄ Version 2.1.0 - Today")
UpdatesTab:CreateLabel("‚Ä¢ Fixed script card loading issues")
UpdatesTab:CreateLabel("‚Ä¢ Corrected database property names")
UpdatesTab:CreateLabel("‚Ä¢ Improved GitHub integration")
UpdatesTab:CreateLabel("‚Ä¢ Enhanced error handling")
UpdatesTab:CreateLabel("")
UpdatesTab:CreateLabel("üöÄ Version 2.0.0 - 1 day ago")
UpdatesTab:CreateLabel("‚Ä¢ Complete UI redesign")
UpdatesTab:CreateLabel("‚Ä¢ Added script thumbnails")
UpdatesTab:CreateLabel("‚Ä¢ New confirmation dialogs")
UpdatesTab:CreateLabel("‚Ä¢ Smooth tab transitions")

-- Add content to Credits tab
CreditsTab:CreateLabel("üöÄ LYNK Script Hub v2.1")
CreditsTab:CreateLabel("")
CreditsTab:CreateLabel("üë®‚Äçüíª Development Team:")
CreditsTab:CreateLabel("‚Ä¢ @x_vvw - Lead Developer")
CreditsTab:CreateLabel("‚Ä¢ Script Hub Community")
CreditsTab:CreateLabel("")
CreditsTab:CreateLabel("üé® Features:")
CreditsTab:CreateLabel("‚Ä¢ Modern GitHub integration")
CreditsTab:CreateLabel("‚Ä¢ Auto game detection")
CreditsTab:CreateLabel("‚Ä¢ Professional card layout")
CreditsTab:CreateLabel("‚Ä¢ Smart search system")
CreditsTab:CreateLabel("")
CreditsTab:CreateLabel("https://discord.gg/AzMbjqD7T3")

-- Add content to Settings tab
SettingsTab:CreateButton("üîÑ Refresh Database", function()
    print("Refreshing script database...")
    SCRIPT_DATABASE = loadScriptDatabase()
    if Window._scriptDatabase then
        Window._scriptDatabase = SCRIPT_DATABASE
    end
    print("‚úÖ Database refreshed!")
end)

SettingsTab:CreateButton("‚å®Ô∏è Toggle Key: RightCtrl", function()
    print("Current toggle key: Right Control")
    print("Key binding customization coming soon!")
end)

SettingsTab:CreateButton("üé® Theme Settings", function()
    print("Theme customization coming soon!")
end)

-- Success message
print("üéâ LYNK Script Hub loaded successfully!")
print("üì± Press RightCtrl to toggle the UI")
print("üîç Script cards should now load properly!")

-- Show current game info
spawn(function()
    wait(1)
    local currentPlaceId = game.PlaceId
    local success, gameInfo = pcall(function()
        return game:GetService("MarketplaceService"):GetProductInfo(currentPlaceId)
    end)
    
    if success then
        print("üéÆ Current Game:", gameInfo.Name)
        if SCRIPT_DATABASE[currentPlaceId] then
            local scriptCount = #SCRIPT_DATABASE[currentPlaceId].scripts
            print("üìù Found", scriptCount, "scripts for this game!")
        else
            print("üìù No specific scripts for this game, showing Universal scripts")
        end
    end
end)
