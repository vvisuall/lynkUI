-- lynkUI v2.0 - Professional Script Hub UI Library
-- Author: Enhanced by Claude for universal script hub
-- Features: Modern design, smooth animations, player profile, search functionality
-- Four main tabs: Home (Script Hub), Updates, Credits, Settings

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
if not LocalPlayer then
    error("lynkUI: LocalPlayer not found - run as a LocalScript / exploit local")
end

-- Enhanced Utilities
local function new(class, props)
    local inst = Instance.new(class)
    if type(props) == "table" then
        for k,v in pairs(props) do
            pcall(function() inst[k] = v end)
        end
    end
    return inst
end

local function createGradient(parent, colors, rotation)
    local gradient = new("UIGradient", {
        Color = ColorSequence.new(colors),
        Rotation = rotation or 0
    })
    gradient.Parent = parent
    return gradient
end

local function createGlow(parent, color, size)
    local glow = new("ImageLabel", {
        Name = "Glow",
        Parent = parent,
        BackgroundTransparency = 1,
        Image = "rbxasset://textures/ui/Glow.png",
        ImageColor3 = color or Color3.new(1,1,1),
        ImageTransparency = 0.8,
        Size = size or UDim2.new(1, 20, 1, 20),
        Position = UDim2.new(0, -10, 0, -10),
        ZIndex = parent.ZIndex - 1
    })
    return glow
end

-- Professional Color Palette
local THEME = {
    WindowSize = UDim2.new(0, 880, 0, 560),
    
    -- Dark theme colors
    Background = Color3.fromRGB(11, 11, 13),
    Surface = Color3.fromRGB(15, 15, 17),
    Panel = Color3.fromRGB(19, 19, 22),
    Card = Color3.fromRGB(23, 23, 27),
    
    -- Accent colors
    Primary = Color3.fromRGB(88, 101, 242),    -- Discord-like purple
    Secondary = Color3.fromRGB(114, 137, 218), -- Lighter purple
    Success = Color3.fromRGB(67, 181, 129),    -- Green
    Warning = Color3.fromRGB(250, 166, 26),    -- Orange
    Danger = Color3.fromRGB(237, 66, 69),      -- Red
    
    -- Text colors
    Text = Color3.fromRGB(255, 255, 255),
    TextSecondary = Color3.fromRGB(185, 187, 190),
    TextMuted = Color3.fromRGB(114, 118, 125),
    
    -- Border and dividers
    Border = Color3.fromRGB(35, 35, 40),
    Divider = Color3.fromRGB(45, 45, 50),
    
    -- Corner radius
    CornerRadius = UDim.new(0, 12),
    SmallCornerRadius = UDim.new(0, 8),
    
    -- Animation settings
    FastTween = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    MediumTween = TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    SlowTween = TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out),
}

local Lynk = {}
Lynk.__index = Lynk

function Lynk:CreateWindow(opts)
    opts = opts or {}
    local Window = {}
    Window._tabs = {}
    Window._currentTab = nil
    Window._accent = opts.Accent or THEME.Primary
    Window._logo = opts.Logo or "rbxassetid://17673929618"
    Window._title = opts.Title or (opts.Name or "lynkUI v2.0")
    Window._subtitle = opts.Subtitle or "Universal Script Hub"
    Window._uiKey = opts.DefaultKeybind or Enum.KeyCode.RightControl

    -- Create ScreenGui with enhanced properties
    local screen = new("ScreenGui", {
        Name = opts.Name or "lynkUI",
        ResetOnSpawn = false,
        DisplayOrder = 10000,
        IgnoreGuiInset = true,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    })
    screen.Parent = LocalPlayer:WaitForChild("PlayerGui")

    -- Main container with blur effect
    local BlurFrame = new("Frame", {
        Name = "BlurContainer",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Color3.new(0, 0, 0),
        BackgroundTransparency = 0.3,
        BorderSizePixel = 0,
        Visible = false
    })
    BlurFrame.Parent = screen

    -- Main window outline
    local Outline = new("Frame", {
        Name = "Outline",
        AnchorPoint = Vector2.new(0.5, 0.5),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = THEME.Border,
        BorderSizePixel = 0,
        ZIndex = 2
    })
    Outline.Parent = BlurFrame
    
    local outlineCorner = new("UICorner")
    outlineCorner.CornerRadius = THEME.CornerRadius
    outlineCorner.Parent = Outline

    -- Add subtle glow to outline
    createGlow(Outline, Window._accent)

    -- Main content frame
    local MainFrame = new("Frame", {
        Name = "MainFrame",
        Position = UDim2.new(0, 2, 0, 2),
        Size = UDim2.new(1, -4, 1, -4),
        BackgroundColor3 = THEME.Background,
        BorderSizePixel = 0
    })
    MainFrame.Parent = Outline
    
    local mainCorner = new("UICorner")
    mainCorner.CornerRadius = THEME.CornerRadius
    mainCorner.Parent = MainFrame

    -- Sidebar (left panel)
    local Sidebar = new("Frame", {
        Name = "Sidebar",
        Size = UDim2.new(0, 280, 1, 0),
        BackgroundColor3 = THEME.Surface,
        BorderSizePixel = 0
    })
    Sidebar.Parent = MainFrame
    
    local sidebarCorner = new("UICorner")
    sidebarCorner.CornerRadius = THEME.CornerRadius
    sidebarCorner.Parent = Sidebar

    -- Sidebar gradient
    createGradient(Sidebar, {
        ColorSequenceKeypoint.new(0, THEME.Surface),
        ColorSequenceKeypoint.new(1, THEME.Panel)
    }, 90)

    -- Player Profile Section
    local ProfileContainer = new("Frame", {
        Name = "ProfileContainer",
        Position = UDim2.new(0, 20, 0, 20),
        Size = UDim2.new(1, -40, 0, 80),
        BackgroundColor3 = THEME.Card,
        BorderSizePixel = 0
    })
    ProfileContainer.Parent = Sidebar
    
    local profileCorner = new("UICorner")
    profileCorner.CornerRadius = THEME.SmallCornerRadius
    profileCorner.Parent = ProfileContainer

    -- Player avatar (circular)
    local AvatarContainer = new("Frame", {
        Name = "AvatarContainer",
        Position = UDim2.new(0, 12, 0, 12),
        Size = UDim2.new(0, 56, 0, 56),
        BackgroundColor3 = THEME.Primary,
        BorderSizePixel = 0
    })
    AvatarContainer.Parent = ProfileContainer
    
    local avatarCorner = new("UICorner")
    avatarCorner.CornerRadius = UDim.new(0.5, 0)
    avatarCorner.Parent = AvatarContainer

    local PlayerAvatar = new("ImageLabel", {
        Name = "PlayerAvatar",
        Position = UDim2.new(0, 2, 0, 2),
        Size = UDim2.new(1, -4, 1, -4),
        Image = Players:GetUserThumbnailAsync(LocalPlayer.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size420x420),
        BackgroundTransparency = 1,
        ScaleType = Enum.ScaleType.Crop
    })
    PlayerAvatar.Parent = AvatarContainer
    
    local playerAvatarCorner = new("UICorner")
    playerAvatarCorner.CornerRadius = UDim.new(0.5, 0)
    playerAvatarCorner.Parent = PlayerAvatar

    -- Player username
    local PlayerName = new("TextLabel", {
        Name = "PlayerName",
        Position = UDim2.new(0, 80, 0, 15),
        Size = UDim2.new(1, -92, 0, 24),
        BackgroundTransparency = 1,
        Text = "@" .. LocalPlayer.Name,
        Font = Enum.Font.GothamBold,
        TextSize = 16,
        TextColor3 = THEME.Text,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd
    })
    PlayerName.Parent = ProfileContainer

    -- Online status indicator
    local StatusIndicator = new("Frame", {
        Name = "StatusIndicator",
        Position = UDim2.new(0, 80, 0, 42),
        Size = UDim2.new(0, 8, 0, 8),
        BackgroundColor3 = THEME.Success,
        BorderSizePixel = 0
    })
    StatusIndicator.Parent = ProfileContainer
    
    local statusCorner = new("UICorner")
    statusCorner.CornerRadius = UDim.new(0.5, 0)
    statusCorner.Parent = StatusIndicator

    local StatusText = new("TextLabel", {
        Name = "StatusText",
        Position = UDim2.new(0, 96, 0, 38),
        Size = UDim2.new(1, -108, 0, 16),
        BackgroundTransparency = 1,
        Text = "Online",
        Font = Enum.Font.Gotham,
        TextSize = 12,
        TextColor3 = THEME.TextSecondary,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    StatusText.Parent = ProfileContainer

    -- Tabs container
    local TabsContainer = new("Frame", {
        Name = "TabsContainer",
        Position = UDim2.new(0, 20, 0, 120),
        Size = UDim2.new(1, -40, 1, -140),
        BackgroundTransparency = 1
    })
    TabsContainer.Parent = Sidebar

    local tabsLayout = new("UIListLayout")
    tabsLayout.Parent = TabsContainer
    tabsLayout.Padding = UDim.new(0, 8)
    tabsLayout.SortOrder = Enum.SortOrder.LayoutOrder

    -- Content area
    local ContentArea = new("Frame", {
        Name = "ContentArea",
        Position = UDim2.new(0, 280, 0, 0),
        Size = UDim2.new(1, -280, 1, 0),
        BackgroundTransparency = 1
    })
    ContentArea.Parent = MainFrame

    -- Top bar in content area
    local TopBar = new("Frame", {
        Name = "TopBar",
        Size = UDim2.new(1, 0, 0, 80),
        BackgroundTransparency = 1
    })
    TopBar.Parent = ContentArea

    -- Title section
    local TitleContainer = new("Frame", {
        Name = "TitleContainer",
        Position = UDim2.new(0, 30, 0, 20),
        Size = UDim2.new(0.6, 0, 0, 40),
        BackgroundTransparency = 1
    })
    TitleContainer.Parent = TopBar

    local MainTitle = new("TextLabel", {
        Name = "MainTitle",
        Size = UDim2.new(1, 0, 0, 24),
        BackgroundTransparency = 1,
        Text = Window._title,
        Font = Enum.Font.GothamBold,
        TextSize = 24,
        TextColor3 = THEME.Text,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    MainTitle.Parent = TitleContainer

    local Subtitle = new("TextLabel", {
        Name = "Subtitle",
        Position = UDim2.new(0, 0, 0, 24),
        Size = UDim2.new(1, 0, 0, 16),
        BackgroundTransparency = 1,
        Text = Window._subtitle,
        Font = Enum.Font.Gotham,
        TextSize = 14,
        TextColor3 = THEME.TextMuted,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    Subtitle.Parent = TitleContainer

    -- Close button (enhanced)
    local CloseButton = new("TextButton", {
        Name = "CloseButton",
        Position = UDim2.new(1, -60, 0, 20),
        Size = UDim2.new(0, 40, 0, 40),
        BackgroundColor3 = THEME.Danger,
        Text = "×",
        Font = Enum.Font.GothamBold,
        TextSize = 20,
        TextColor3 = THEME.Text,
        AutoButtonColor = false
    })
    CloseButton.Parent = TopBar
    
    local closeCorner = new("UICorner")
    closeCorner.CornerRadius = THEME.SmallCornerRadius
    closeCorner.Parent = CloseButton

    -- Close button hover effects
    local function animateButton(button, hoverColor, normalColor)
        button.MouseEnter:Connect(function()
            TweenService:Create(button, THEME.FastTween, {BackgroundColor3 = hoverColor}):Play()
        end)
        button.MouseLeave:Connect(function()
            TweenService:Create(button, THEME.FastTween, {BackgroundColor3 = normalColor}):Play()
        end)
    end
    animateButton(CloseButton, Color3.fromRGB(220, 50, 50), THEME.Danger)

    -- Close confirmation popup
    local function createCloseConfirmation()
        local ConfirmationFrame = new("Frame", {
            Name = "ConfirmationFrame",
            AnchorPoint = Vector2.new(0.5, 0.5),
            Position = UDim2.new(0.5, 0, 0.5, 0),
            Size = UDim2.new(0, 400, 0, 180),
            BackgroundColor3 = THEME.Surface,
            BorderSizePixel = 0,
            ZIndex = 1000,
            Visible = false
        })
        ConfirmationFrame.Parent = screen
        
        local confirmCorner = new("UICorner")
        confirmCorner.CornerRadius = THEME.CornerRadius
        confirmCorner.Parent = ConfirmationFrame
        
        -- Add border glow
        local confirmStroke = new("UIStroke", {
            Thickness = 1,
            Color = THEME.Border,
            Parent = ConfirmationFrame
        })

        -- Title
        local ConfirmTitle = new("TextLabel", {
            Name = "ConfirmTitle",
            Position = UDim2.new(0, 20, 0, 20),
            Size = UDim2.new(1, -40, 0, 24),
            BackgroundTransparency = 1,
            Text = "Close Script Hub?",
            Font = Enum.Font.GothamBold,
            TextSize = 18,
            TextColor3 = THEME.Text,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        ConfirmTitle.Parent = ConfirmationFrame

        -- Description
        local ConfirmDesc = new("TextLabel", {
            Name = "ConfirmDesc",
            Position = UDim2.new(0, 20, 0, 50),
            Size = UDim2.new(1, -40, 0, 60),
            BackgroundTransparency = 1,
            Text = "Instead of closing, you can press RightCtrl to toggle the UI anytime!\n\nAre you sure you want to close?",
            Font = Enum.Font.Gotham,
            TextSize = 14,
            TextColor3 = THEME.TextSecondary,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextYAlignment = Enum.TextYAlignment.Top,
            TextWrapped = true
        })
        ConfirmDesc.Parent = ConfirmationFrame

        -- Button container
        local ButtonContainer = new("Frame", {
            Name = "ButtonContainer",
            Position = UDim2.new(0, 20, 1, -60),
            Size = UDim2.new(1, -40, 0, 40),
            BackgroundTransparency = 1
        })
        ButtonContainer.Parent = ConfirmationFrame

        -- No button (Cancel - Red)
        local NoButton = new("TextButton", {
            Name = "NoButton",
            Size = UDim2.new(0.48, 0, 1, 0),
            BackgroundColor3 = THEME.Danger,
            Text = "No, Keep Open",
            Font = Enum.Font.GothamSemibold,
            TextSize = 14,
            TextColor3 = THEME.Text,
            AutoButtonColor = false
        })
        NoButton.Parent = ButtonContainer
        
        local noCorner = new("UICorner")
        noCorner.CornerRadius = THEME.SmallCornerRadius
        noCorner.Parent = NoButton

        -- Yes button (Confirm - Green)
        local YesButton = new("TextButton", {
            Name = "YesButton",
            Position = UDim2.new(0.52, 0, 0, 0),
            Size = UDim2.new(0.48, 0, 1, 0),
            BackgroundColor3 = THEME.Success,
            Text = "Yes, Close",
            Font = Enum.Font.GothamSemibold,
            TextSize = 14,
            TextColor3 = THEME.Text,
            AutoButtonColor = false
        })
        YesButton.Parent = ButtonContainer
        
        local yesCorner = new("UICorner")
        yesCorner.CornerRadius = THEME.SmallCornerRadius
        yesCorner.Parent = YesButton

        -- Button hover effects
        animateButton(NoButton, Color3.fromRGB(220, 50, 50), THEME.Danger)
        animateButton(YesButton, Color3.fromRGB(50, 160, 100), THEME.Success)

        -- Show confirmation with animation
        local function showConfirmation()
            ConfirmationFrame.Visible = true
            ConfirmationFrame.Size = UDim2.new(0, 0, 0, 0)
            TweenService:Create(ConfirmationFrame, THEME.MediumTween, {
                Size = UDim2.new(0, 400, 0, 180)
            }):Play()
        end

        -- Hide confirmation
        local function hideConfirmation()
            TweenService:Create(ConfirmationFrame, THEME.FastTween, {
                Size = UDim2.new(0, 0, 0, 0)
            }):Play()
            task.wait(0.15)
            ConfirmationFrame.Visible = false
        end

        -- Button events
        NoButton.MouseButton1Click:Connect(function()
            hideConfirmation()
            setVisibility(false) -- Hide UI but don't destroy
        end)

        YesButton.MouseButton1Click:Connect(function()
            hideConfirmation()
            Window:Destroy() -- Actually close
        end)

        return showConfirmation
    end

    local showCloseConfirmation = createCloseConfirmation()

    CloseButton.MouseButton1Click:Connect(function()
        showCloseConfirmation()
    end)

    -- Pages container with smooth transitions
    local PagesContainer = new("Frame", {
        Name = "PagesContainer",
        Position = UDim2.new(0, 30, 0, 80),
        Size = UDim2.new(1, -60, 1, -100),
        BackgroundTransparency = 1,
        ClipsDescendants = true
    })
    PagesContainer.Parent = ContentArea

    -- Store references
    Window._screen = screen
    Window._blurFrame = BlurFrame
    Window._outline = Outline
    Window._mainFrame = MainFrame
    Window._sidebar = Sidebar
    Window._tabsContainer = TabsContainer
    Window._pagesContainer = PagesContainer
    Window._titleLabel = MainTitle
    Window._subtitleLabel = Subtitle

    -- Dragging functionality
    local dragging = false
    local dragStart = nil
    local startPos = nil

    local function updateDrag(input)
        if dragging then
            local delta = input.Position - dragStart
            local newPos = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, 
                                   startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            TweenService:Create(Outline, THEME.FastTween, {Position = newPos}):Play()
        end
    end

    TopBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = Outline.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    TopBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            updateDrag(input)
        end
    end)

    -- Window visibility toggle
    local isVisible = false
    
    local function setVisibility(visible)
        isVisible = visible
        BlurFrame.Visible = visible
        
        if visible then
            -- Animate window opening
            Outline.Size = UDim2.new(0, 0, 0, 0)
            TweenService:Create(Outline, THEME.SlowTween, {
                Size = THEME.WindowSize
            }):Play()
        else
            -- Animate window closing
            TweenService:Create(Outline, THEME.MediumTween, {
                Size = UDim2.new(0, 0, 0, 0)
            }):Play()
            
            task.wait(0.25)
            if not isVisible then
                BlurFrame.Visible = false
            end
        end
    end

    -- Keybind listener
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        if input.KeyCode == Window._uiKey then
            setVisibility(not isVisible)
        end
    end)

    -- Tab creation and management
    function Window:CreateTab(name, icon, layoutOrder)
        local tab = {
            Name = name,
            Icon = icon or "",
            LayoutOrder = layoutOrder or (#Window._tabs + 1),
            Active = false
        }

        -- Tab button
        local TabButton = new("TextButton", {
            Name = name .. "_TabButton",
            Size = UDim2.new(1, 0, 0, 48),
            BackgroundColor3 = Color3.fromRGB(0, 0, 0),
            BackgroundTransparency = 1,
            BorderSizePixel = 0,
            Text = "",
            AutoButtonColor = false,
            LayoutOrder = tab.LayoutOrder
        })
        TabButton.Parent = TabsContainer
        
        local tabCorner = new("UICorner")
        tabCorner.CornerRadius = THEME.SmallCornerRadius
        tabCorner.Parent = TabButton

        -- Tab icon
        local TabIcon = new("ImageLabel", {
            Name = "TabIcon",
            Position = UDim2.new(0, 16, 0.5, -10),
            Size = UDim2.new(0, 20, 0, 20),
            BackgroundTransparency = 1,
            Image = tab.Icon,
            ImageColor3 = THEME.TextMuted,
            ScaleType = Enum.ScaleType.Fit
        })
        TabIcon.Parent = TabButton

        -- Tab text
        local TabText = new("TextLabel", {
            Name = "TabText",
            Position = UDim2.new(0, 48, 0, 0),
            Size = UDim2.new(1, -60, 1, 0),
            BackgroundTransparency = 1,
            Text = name,
            Font = Enum.Font.GothamSemibold,
            TextSize = 15,
            TextColor3 = THEME.TextMuted,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        TabText.Parent = TabButton

        -- Active indicator
        local ActiveIndicator = new("Frame", {
            Name = "ActiveIndicator",
            Position = UDim2.new(0, 0, 0.5, -12),
            Size = UDim2.new(0, 3, 0, 24),
            BackgroundColor3 = Window._accent,
            BorderSizePixel = 0,
            Visible = false
        })
        ActiveIndicator.Parent = TabButton
        
        local indicatorCorner = new("UICorner")
        indicatorCorner.CornerRadius = UDim.new(0, 2)
        indicatorCorner.Parent = ActiveIndicator

        -- Tab page
        local TabPage = new("Frame", {
            Name = name .. "_Page",
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundTransparency = 1,
            Visible = false
        })
        TabPage.Parent = PagesContainer

        -- Tab functions
        function tab:Show()
            -- Hide all other tabs
            for _, otherTab in pairs(Window._tabs) do
                if otherTab ~= tab then
                    otherTab:Hide()
                end
            end
            
            -- Show this tab
            tab.Active = true
            Window._currentTab = tab
            
            -- Animate tab appearance
            TabPage.Position = UDim2.new(1, 0, 0, 0)
            TabPage.Visible = true
            
            TweenService:Create(TabPage, THEME.MediumTween, {
                Position = UDim2.new(0, 0, 0, 0)
            }):Play()
            
            -- Update button appearance
            TweenService:Create(TabButton, THEME.FastTween, {
                BackgroundTransparency = 0,
                BackgroundColor3 = Color3.fromRGB(255, 255, 255):lerp(Window._accent, 0.9)
            }):Play()
            TweenService:Create(TabText, THEME.FastTween, {TextColor3 = THEME.Text}):Play()
            TweenService:Create(TabIcon, THEME.FastTween, {ImageColor3 = Window._accent}):Play()
            ActiveIndicator.Visible = true
        end
        
        function tab:Hide()
            tab.Active = false
            
            -- Animate tab disappearance
            if TabPage.Visible then
                TweenService:Create(TabPage, THEME.FastTween, {
                    Position = UDim2.new(-1, 0, 0, 0)
                }):Play()
                
                task.wait(0.15)
                TabPage.Visible = false
                TabPage.Position = UDim2.new(0, 0, 0, 0)
            end
            
            -- Reset button appearance
            TweenService:Create(TabButton, THEME.FastTween, {
                BackgroundTransparency = 1
            }):Play()
            TweenService:Create(TabText, THEME.FastTween, {TextColor3 = THEME.TextMuted}):Play()
            TweenService:Create(TabIcon, THEME.FastTween, {ImageColor3 = THEME.TextMuted}):Play()
            ActiveIndicator.Visible = false
        end

        -- Button hover effects
        TabButton.MouseEnter:Connect(function()
            if not tab.Active then
                TweenService:Create(TabButton, THEME.FastTween, {
                    BackgroundTransparency = 0.95,
                    BackgroundColor3 = THEME.TextMuted
                }):Play()
            end
        end)
        
        TabButton.MouseLeave:Connect(function()
            if not tab.Active then
                TweenService:Create(TabButton, THEME.FastTween, {
                    BackgroundTransparency = 1
                }):Play()
            end
        end)

        TabButton.MouseButton1Click:Connect(function()
            tab:Show()
        end)

        -- Store references
        tab.Button = TabButton
        tab.Page = TabPage
        tab.Icon = TabIcon
        tab.Text = TabText

        Window._tabs[#Window._tabs + 1] = tab
        return tab
    end

    -- Enhanced search functionality for script hub
    function Window:CreateSearchBar(parent, callback)
        local SearchContainer = new("Frame", {
            Name = "SearchContainer",
            Size = UDim2.new(1, 0, 0, 50),
            BackgroundColor3 = THEME.Card,
            BorderSizePixel = 0
        })
        SearchContainer.Parent = parent
        
        local searchCorner = new("UICorner")
        searchCorner.CornerRadius = THEME.SmallCornerRadius
        searchCorner.Parent = SearchContainer

        -- Search icon
        local SearchIcon = new("ImageLabel", {
            Name = "SearchIcon",
            Position = UDim2.new(0, 15, 0.5, -8),
            Size = UDim2.new(0, 16, 0, 16),
            BackgroundTransparency = 1,
            Image = "rbxassetid://3926305904",
            ImageColor3 = THEME.TextMuted,
            ImageRectOffset = Vector2.new(964, 324),
            ImageRectSize = Vector2.new(36, 36)
        })
        SearchIcon.Parent = SearchContainer

        -- Search textbox
        local SearchBox = new("TextBox", {
            Name = "SearchBox",
            Position = UDim2.new(0, 45, 0, 0),
            Size = UDim2.new(1, -90, 1, 0),
            BackgroundTransparency = 1,
            PlaceholderText = "Search for scripts, games, or keywords...",
            Text = "",
            Font = Enum.Font.Gotham,
            TextSize = 14,
            TextColor3 = THEME.Text,
            TextXAlignment = Enum.TextXAlignment.Left,
            ClearButtonEnabled = true
        })
        SearchBox.Parent = SearchContainer

        -- Search box events
        SearchBox.Focused:Connect(function()
            TweenService:Create(SearchContainer, THEME.FastTween, {
                BackgroundColor3 = THEME.Panel
            }):Play()
            TweenService:Create(SearchIcon, THEME.FastTween, {
                ImageColor3 = Window._accent
            }):Play()
        end)

        SearchBox.FocusLost:Connect(function()
            TweenService:Create(SearchContainer, THEME.FastTween, {
                BackgroundColor3 = THEME.Card
            }):Play()
            TweenService:Create(SearchIcon, THEME.FastTween, {
                ImageColor3 = THEME.TextMuted
            }):Play()
        end)

        if callback then
            SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
                callback(SearchBox.Text)
            end)
        end

        return SearchBox
    end

    -- Utility functions for creating UI elements
    function Window:CreateButton(parent, text, callback)
        local button = new("TextButton", {
            Size = UDim2.new(1, 0, 0, 40),
            BackgroundColor3 = Window._accent,
            BorderSizePixel = 0,
            Text = text or "Button",
            Font = Enum.Font.GothamSemibold,
            TextSize = 14,
            TextColor3 = THEME.Text,
            AutoButtonColor = false
        })
        button.Parent = parent
        
        local corner = new("UICorner")
        corner.CornerRadius = THEME.SmallCornerRadius
        corner.Parent = button

        -- Hover effects
        button.MouseEnter:Connect(function()
            TweenService:Create(button, THEME.FastTween, {
                BackgroundColor3 = button.BackgroundColor3:lerp(Color3.new(1,1,1), 0.1)
            }):Play()
        end)
        
        button.MouseLeave:Connect(function()
            TweenService:Create(button, THEME.FastTween, {
                BackgroundColor3 = Window._accent
            }):Play()
        end)

        if callback then
            button.MouseButton1Click:Connect(callback)
        end

    -- Script Hub functionality
    function Window:CreateScriptHub(tab, scripts)
        scripts = scripts or {}
        
        -- Main container with scrolling
        local HubContainer = new("Frame", {
            Name = "HubContainer",
            Size = UDim2.new(1, 0, 1, -60), -- Leave space for search bar
            Position = UDim2.new(0, 0, 0, 60),
            BackgroundTransparency = 1
        })
        HubContainer.Parent = tab.Page

        local ScrollFrame = new("ScrollingFrame", {
            Name = "ScriptScroll",
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundTransparency = 1,
            BorderSizePixel = 0,
            ScrollBarThickness = 6,
            ScrollBarImageColor3 = THEME.TextMuted,
            CanvasSize = UDim2.new(0, 0, 0, 0),
            AutomaticCanvasResize = true
        })
        ScrollFrame.Parent = HubContainer

        -- Grid layout for script cards
        local GridLayout = new("UIGridLayout", {
            CellSize = UDim2.new(0, 280, 0, 160),
            CellPadding = UDim2.new(0, 15, 0, 15),
            HorizontalAlignment = Enum.HorizontalAlignment.Left,
            VerticalAlignment = Enum.VerticalAlignment.Top,
            StartCorner = Enum.StartCorner.TopLeft
        })
        GridLayout.Parent = ScrollFrame

        -- Padding for the scroll frame
        local ScrollPadding = new("UIPadding", {
            PaddingAll = UDim.new(0, 15)
        })
        ScrollPadding.Parent = ScrollFrame

        -- Function to create a script card
        local function createScriptCard(scriptData)
            local Card = new("Frame", {
                Name = "ScriptCard_" .. (scriptData.Name or "Unknown"),
                BackgroundColor3 = THEME.Card,
                BorderSizePixel = 0,
                ClipsDescendants = true
            })
            Card.Parent = ScrollFrame
            
            local cardCorner = new("UICorner")
            cardCorner.CornerRadius = THEME.SmallCornerRadius
            cardCorner.Parent = Card

            -- Card hover effect
            local cardStroke = new("UIStroke", {
                Thickness = 1,
                Color = THEME.Border,
                Transparency = 1
            })
            cardStroke.Parent = Card

            Card.MouseEnter:Connect(function()
                TweenService:Create(Card, THEME.FastTween, {
                    BackgroundColor3 = THEME.Panel
                }):Play()
                TweenService:Create(cardStroke, THEME.FastTween, {
                    Transparency = 0,
                    Color = Window._accent
                }):Play()
            end)

            Card.MouseLeave:Connect(function()
                TweenService:Create(Card, THEME.FastTween, {
                    BackgroundColor3 = THEME.Card
                }):Play()
                TweenService:Create(cardStroke, THEME.FastTween, {
                    Transparency = 1
                }):Play()
            end)

            -- Game thumbnail
            local GameImage = new("ImageLabel", {
                Name = "GameImage",
                Size = UDim2.new(1, 0, 0, 80),
                BackgroundColor3 = THEME.Surface,
                BorderSizePixel = 0,
                Image = scriptData.GameThumbnail or "",
                ScaleType = Enum.ScaleType.Crop
            })
            GameImage.Parent = Card
            
            local imageCorner = new("UICorner")
            imageCorner.CornerRadius = UDim.new(0, 8)
            imageCorner.Parent = GameImage

            -- Key system indicator (if script has key system)
            if scriptData.HasKeySystem then
                local KeyIndicator = new("Frame", {
                    Name = "KeyIndicator",
                    Position = UDim2.new(1, -30, 0, 8),
                    Size = UDim2.new(0, 22, 0, 22),
                    BackgroundColor3 = THEME.Warning,
                    BorderSizePixel = 0
                })
                KeyIndicator.Parent = GameImage
                
                local keyCorner = new("UICorner")
                keyCorner.CornerRadius = UDim.new(0, 4)
                keyCorner.Parent = KeyIndicator

                local KeyIcon = new("ImageLabel", {
                    Name = "KeyIcon",
                    Position = UDim2.new(0.5, -6, 0.5, -6),
                    Size = UDim2.new(0, 12, 0, 12),
                    BackgroundTransparency = 1,
                    Image = "rbxassetid://3926305904", -- Key icon
                    ImageColor3 = Color3.new(1, 1, 1),
                    ImageRectOffset = Vector2.new(324, 124),
                    ImageRectSize = Vector2.new(36, 36)
                })
                KeyIcon.Parent = KeyIndicator
            end

            -- Game name
            local GameName = new("TextLabel", {
                Name = "GameName",
                Position = UDim2.new(0, 12, 0, 88),
                Size = UDim2.new(1, -24, 0, 18),
                BackgroundTransparency = 1,
                Text = scriptData.GameName or "Unknown Game",
                Font = Enum.Font.GothamSemibold,
                TextSize = 13,
                TextColor3 = THEME.TextSecondary,
                TextXAlignment = Enum.TextXAlignment.Left,
                TextTruncate = Enum.TextTruncate.AtEnd
            })
            GameName.Parent = Card

            -- Script name
            local ScriptName = new("TextLabel", {
                Name = "ScriptName",
                Position = UDim2.new(0, 12, 0, 108),
                Size = UDim2.new(1, -24, 0, 20),
                BackgroundTransparency = 1,
                Text = scriptData.Name or "Script",
                Font = Enum.Font.GothamBold,
                TextSize = 15,
                TextColor3 = THEME.Text,
                TextXAlignment = Enum.TextXAlignment.Left,
                TextTruncate = Enum.TextTruncate.AtEnd
            })
            ScriptName.Parent = Card

            -- Execute button
            local ExecuteButton = new("TextButton", {
                Name = "ExecuteButton",
                Position = UDim2.new(0, 12, 1, -40),
                Size = UDim2.new(1, -24, 0, 28),
                BackgroundColor3 = Window._accent,
                BorderSizePixel = 0,
                Text = "Execute",
                Font = Enum.Font.GothamSemibold,
                TextSize = 13,
                TextColor3 = THEME.Text,
                AutoButtonColor = false
            })
            ExecuteButton.Parent = Card
            
            local executeCorner = new("UICorner")
            executeCorner.CornerRadius = UDim.new(0, 6)
            executeCorner.Parent = ExecuteButton

            -- Execute button effects
            ExecuteButton.MouseEnter:Connect(function()
                TweenService:Create(ExecuteButton, THEME.FastTween, {
                    BackgroundColor3 = ExecuteButton.BackgroundColor3:lerp(Color3.new(1,1,1), 0.1)
                }):Play()
            end)
            
            ExecuteButton.MouseLeave:Connect(function()
                TweenService:Create(ExecuteButton, THEME.FastTween, {
                    BackgroundColor3 = Window._accent
                }):Play()
            end)

            ExecuteButton.MouseButton1Click:Connect(function()
                if scriptData.Callback then
                    pcall(scriptData.Callback)
                elseif scriptData.Source then
                    pcall(function()
                        loadstring(scriptData.Source)()
                    end)
                elseif scriptData.Url then
                    pcall(function()
                        loadstring(game:HttpGet(scriptData.Url))()
                    end)
                end
            end)

            return Card
        end

        -- Function to populate scripts
        local function populateScripts(scriptList, filterText)
            filterText = filterText and filterText:lower() or ""
            
            -- Clear existing cards
            for _, child in pairs(ScrollFrame:GetChildren()) do
                if child.Name:sub(1, 11) == "ScriptCard_" then
                    child:Destroy()
                end
            end

            -- Add filtered scripts
            for _, script in ipairs(scriptList) do
                local shouldShow = filterText == "" or
                    (script.Name and script.Name:lower():find(filterText, 1, true)) or
                    (script.GameName and script.GameName:lower():find(filterText, 1, true)) or
                    (script.Tags and table.concat(script.Tags, " "):lower():find(filterText, 1, true))

                if shouldShow then
                    createScriptCard(script)
                end
            end
        end

        -- Create search bar
        local searchBox = Window:CreateSearchBar(tab.Page, function(query)
            populateScripts(scripts, query)
        end)

        -- Initial population
        populateScripts(scripts)

        return {
            UpdateScripts = function(newScripts)
                scripts = newScripts
                populateScripts(scripts, searchBox.Text)
            end,
            AddScript = function(scriptData)
                table.insert(scripts, scriptData)
                populateScripts(scripts, searchBox.Text)
            end
        }
    end

    function Window:Destroy()
        if screen and screen.Parent then
            screen:Destroy()
        end
    end

    -- Initialize with opening animation
    setVisibility(true)

    setmetatable(Window, {__index = Lynk})
    return Window
end

return Lynk
